{% extends 'base.html.twig' %}

{% block body %}
	<div class="container-fluid mt-2">
		<!-- Header Section -->
		<div class="user-management-header text-center">
			<div class="container">
				<h1 class="mb-3">
					<i class="fas fa-users me-3"></i>
					Gestion des utilisateurs
				</h1>
				<p class="mb-0 opacity-75">Gérez les rôles et permissions de vos utilisateurs</p>
			</div>
		</div>

		<!-- Stats Cards -->
		<div class="row mb-4 d-flex justify-content-center">
			<div class="col-md-4 mb-3">
				<div class="stats-card text-center">
					<div class="stats-number">{{ users|length }}</div>
					<div class="text-muted">Total utilisateurs</div>
				</div>
			</div>
			<div class="col-md-4 mb-3">
				<div class="stats-card text-center">
					<div class="stats-number">
						{% set adminCount = 0 %}
						{% for user in users %}
							{% if 'ROLE_ADMIN' in user.roles %}
								{% set adminCount = adminCount + 1 %}
							{% endif %}
						{% endfor %}
						{{ adminCount }}
					</div>
					<div class="text-muted">Administrateurs</div>
				</div>
			</div>
		</div>

		<!-- Users Table -->
		<div class="custom-table mb-5">
			<table class="table table-hover mb-0">
				<thead>
					<tr>
						<th>
							<i class="fas fa-user me-2"></i>Utilisateur</th>
						<th>
							<i class="fas fa-envelope me-2"></i>Email</th>
						<th>
							<i class="fas fa-shield-alt me-2"></i>Rôle</th>
						<th>
							<i class="fas fa-cogs me-2"></i>Gestion des rôles</th>
						<th>
							<i class="fas fa-trash-alt me-2"></i>Actions</th>
					</tr>
				</thead>
				<tbody>
					{% for user in users %}
						<tr>
							<td>
								<div class="d-flex align-items-center">
									<div class="user-avatar me-3">
										{{ user.name|first|upper }}{{ user.surname|first|upper }}
									</div>
									<div>
										<div class="fw-semibold">{{ user.surname }}
											{{ user.name }}</div>
										<small class="text-muted">ID: #{{ user.id }}</small>
									</div>
								</div>
							</td>
							<td>
								<div class="d-flex align-items-center">
									<i class="fas fa-envelope text-muted me-2"></i>
									{{ user.email }}
								</div>
							</td>
							<td>
								{% if 'ROLE_ADMIN' in user.roles %}
									<span class="role-badge role-admin">
										<i class="fas fa-crown me-1"></i>Admin
									</span>
								{% else %}
									<span class="role-badge role-user">
										<i class="fas fa-user me-1"></i>User
									</span>
								{% endif %}
							</td>
							<td>
								<form method="post" action="{{ path('admin_user_role', {id: user.id}) }}" class="d-inline-block">
									<div class="d-flex align-items-center gap-2">
										<select name="role" class="role-select">
											<option value="ROLE_USER" {% if 'ROLE_ADMIN' not in user.roles %} selected {% endif %}>
												👤 Utilisateur
											</option>
											<option value="ROLE_ADMIN" {% if 'ROLE_ADMIN' in user.roles %} selected {% endif %}>
												👑 Administrateur
											</option>
										</select>
										<button type="submit" class="btn btn-modern btn-update">
											<i class="fas fa-sync-alt me-1"></i>
											Modifier
										</button>
									</div>
								</form>
							</td>
							<td>
								<div class="action-buttons">
									<form method="post" action="{{ path('admin_user_delete', {id: user.id}) }}" onsubmit="return confirm('⚠️ Êtes-vous sûr de vouloir supprimer {{ user.surname }} {{ user.name }} ?\n\nCette action est irréversible.');" class="d-inline-block">
										<input type="hidden" name="_token" value="{{ csrf_token('delete' ~ user.id) }}">
										<button type="submit" class="btn btn-modern btn-delete">
											<i class="fas fa-trash-alt me-1"></i>
											Supprimer
										</button>
									</form>
								</div>
							</td>
						</tr>
					{% else %}
						<tr>
							<td colspan="5" class="text-center py-5">
								<i class="fas fa-users text-muted" style="font-size: 3rem;"></i>
								<p class="text-muted mt-3 mb-0">Aucun utilisateur trouvé</p>
							</td>
						</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>
	</div>

	<!-- Confirmation Modal (optionnel, pour remplacer les confirms JavaScript) -->
	<div class="modal fade" id="deleteModal" tabindex="-1">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">
						<i class="fas fa-exclamation-triangle text-warning me-2"></i>
						Confirmer la suppression
					</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
				</div>
				<div class="modal-body">
					<p>Êtes-vous sûr de vouloir supprimer cet utilisateur ?</p>
					<p class="text-muted mb-0">Cette action est irréversible.</p>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
					<button type="button" class="btn btn-danger" id="confirmDelete">Supprimer</button>
				</div>
			</div>
		</div>
	</div>
{% endblock %}
